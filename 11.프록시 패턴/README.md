## Chapter 11

### 객체 접근 제어하기
10단원에서 뽑기 기계의 상태를 확실히 파악하고 싶어 모든 뽑기 기계의 재고와 현재 상태를 알려주는 기능을 추가하려고 한다.

위치는 GumballMachine에 location을 추가하면 된다.

그런데 알고보니 뽑기 기계를 원격으로 모니러팅하고 싶어했다.

이를 위해서는 원격 프록시 역할을 이용하면 된다.

보안 공부할 때 프록시를 많이 봐왔다. 그것과 똑같다.
```
GumballMachine(local desktop) <-> Proxy <-> request() <-> GumballMachine(machine : jvm 이용)
```

위의 글처럼 프록시를 중간에 두어 로컬 대변자 역할을 하게 하는 방식이다.

클라이언트, 뽑기 기계는 서로에게 보내는 것처럼 행동하지만 실제로는 프록시가 중간에 받아서 전달해주는 중간 매개자 역할을 한다.

### 프록시 패턴
프록시 패턴은 특정 객체로의 접근을 제어하는 대리인(특정 객체를 대변하는 객체, 즉 프록시)을 제공한다.

이를 통해 클라이언트의 접근을 제어할 수 있으며, 접근을 관리하는 방법에는 여러가지가 존재한다.

### 프록시 패턴의 종류
프록시 패턴에는 다양한 변종들이 존재하는데,
모든 변종의 공통점은 클라이언트가 실제 객체의 메소드를 호출하면 그 호출을 프록시가 중간에 가로챈다는 점이다.

**가상프록시**

꼭 필요로 하는 시점까지 객체의 생성을 연기하고, 해당 객체가 생성된 것 처럼 동작하도록 만들고 싶을 때 사용하는 패턴이다. 프록시 클래스에서 작은 단위의 작업을 처리하고 리소스가 많이 요구되는 작업들이 필요할 경우만 주체 클래스를 사용하도록 구현한다.

**원격프록시**

원격 객체에 대한 접근을 제어 로컬 환경에 존재하며, 원격 객체에 대한 대변자 역할을 하는 객체 서로 다른 주소 공간에 있는 객체에 대해 마치 같은 주소 공간에 있는 것 처럼 동작하게 하는 패턴이다.(예: Google Docs)

**보호프록시**

주체 클래스에 대한 접근을 제어하기 위한 경우에 객체에 대한 접근 권한을 제어하거나 객체마다 접근 권한을 달리하고 싶을 경우 사용하는 패턴으로 프록시 클래스에서 클라이언트가 주체 클래스에 대한 접근을 허용할지 말지 결정하도록 할 수 있다.

### 원격 프록시 추가
Duck d = <다른 힙의 객체> 형태로는 호출이 안된다.

자바의 원격 메소드 호출(Remote Method Invocation(RMI))가 쓰인다.

클래스는 총 3가지로 이루어진다.

1. Subject 인터페이스

2. RealSubject 클래스 : 진짜 작업을 대부분 처리하는 서비스 객체

3. Proxy 클래스 : 서비스 객체의 대변인 역할을 하면서 이 객체로의 접근을 제어한다.
서비스 객체의 레퍼런스가 들어있어, 클라이언트가 서비스가 필요하다면 이 레퍼런스를 사용해서 서비스 객체에 요청을 전달한다.
Proxy에서 RealSubject의 인스턴스를 생성하거나, 그 객체의 생성 과정에 관여하는 경우가 많다.

Server1 디렉터리에서는 MyRemote,MyRemoteImpl로 볼 수 있다.

실행 방법
1. rmiregistry 터미널에서 명령어 실행
2. cd 명령어로 디렉터리를 11.프록시 패턴까지만 이동하고 java /Code/Server1/파일_이름 을 실행하면 된다. (서버 먼저, 클라이언트 나중에)

### 또 다른 예시 : 이미지
예를 들어 용량이 큰 이미지와 글이 같이 있는 문서를 화면에 띄운다고 가정했을때, 텍스트는 용량이 작아서 빠르게 나타나지만 이미지는 용량이 크기 때문에 느리게 로딩되는 것을 확인할 수 있다. 만약 이렇게 처리되지 않고 텍스트와 이미지 로딩이 모두 끝난 후 화면이 나온다면 사용자는 로딩이 끝날때까지 기다려야 한다.

따라서, 로딩이 먼저 끝난 텍스트를 먼저 나오게 하는 것이 좋다. 이와 같은 방식을 가지려면 텍스트 처리용 프로세스, 이미지 처리용 프로세스를 별도로 운영하면 될 것이다.

Image 폴더에서 볼 수 있다.


### 동적 프록시(dynamic proxy)
프록시를 사용하기 위해서는 대상 클래스 수만큼의 프록시 클래스를 하나하나 만들어 주어야 한다는 단점이 존재하며,
이에 코드 중복 또한 발생하게 된다.

이 단점을 보완하기 위해 동적 프록시가 존재하는데,
컴파일 시점이 아닌, 런타임 시점에 프록시 클래스를 만들어주는 방식이다.

동적 프록시를 사용하면 프록시를 적용할 코드를 하나만 만들어 두고 프록시 객체를 런타임 시점에만 생성해주면 된다.

자바의 java.lang.reflect 패키지 안에 프록시 기능이 내장되어 있다.

### 참고 : 데이터 직렬화와 역직렬화
데이터 직렬화 : 메모리를 디스크에 저장하거나, 네트워크 통신에 사용하기 위한 형식으로 변환하는 것

데이터 역직렬화 : 디스크에 저장한 데이터를 읽거나, 네트워크 통신으로 받은 데이터를 메모리에 쓸 수 있도록 변환하는 것

직렬화를 하게 되면 각 주소 값이 가지는 데이터를 전부 끌어 모아서 값 형식 데이터로 변환해 준다.` 

직렬화가 된 데이터는 언어에 따라서 텍스트 또는 바이너리 등의 형태가 되는데,
이러한 형태가 되었을 때 저장하거나 통신할 때 파싱이 가능한 유의미한 데이터가 된다.

즉, 직렬화를 하는 이유는 사용하고 있는 데이터를 파일 저장 혹은 데이터 통신에서 파싱할 수 있는 유의미한 데이터를 만들기 위함이다.